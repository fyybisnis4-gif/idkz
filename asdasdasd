local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/fyywannafly-sudo/FyyCommunity/refs/heads/main/lib_fyy"))()

WindUI:AddTheme({
    Name = "Fyy Community", 
    Accent = WindUI:Gradient({                                                  
        ["0"] = { Color = Color3.fromHex("#1f1f23"), Transparency = 0 },        
        ["100"]   = { Color = Color3.fromHex("#18181b"), Transparency = 0 },    
    }, {                                                                        
        Rotation = 0,                                                           
    }),                                                                         
    Dialog = Color3.fromHex("#161616"),
    Outline = Color3.fromHex("#FFFFFF"),
    Text = Color3.fromHex("#FFFFFF"),
    Placeholder = Color3.fromHex("#7a7a7a"),
    Background = Color3.fromHex("#101010"),
    Button = Color3.fromHex("#52525b"),
    Icon = Color3.fromHex("#a1a1aa")
})

local Window = WindUI:CreateWindow({
    Title = "Fyy Community | Mount",
    Icon = "rbxassetid://106899268176689", 
    Author = "Fyy X Mount",
    Folder = "FyyConfig",
    Size = UDim2.fromOffset(530, 300),
    MinSize = Vector2.new(320, 300),
    MaxSize = Vector2.new(850, 560),
    Transparent = true,
    Theme = "Dark",
    Resizable = false,
    SideBarWidth = 150,
    BackgroundImageTransparency = 0.42,
    HideSearchBar = false,
    ScrollBarEnabled = false,
    Background = "rbxassetid://78893380921225", 
})

Window:SetToggleKey(Enum.KeyCode.G)

WindUI:Notify({
    Title = "FyyLoader",
    Content = "Press G To Open/Close Menu!",
    Duration = 4, 
    Icon = "slack",
})

Window:EditOpenButton({
    Title = "Fyy Community",
    Icon = "rbxassetid://106899268176689",
    CornerRadius = UDim.new(0,16),
    StrokeThickness = 2,
    Color = ColorSequence.new(
        Color3.fromHex("AA00FF")
    ),
    OnlyMobile = true,
    Enabled = true,
    Draggable = true,
})

Window:SetIconSize(35) 
Window:Tag({
    Title = "1.1.0",
    Color = Color3.fromHex("#30ff6a"),
    Radius = 13, 
})

local UIS=game:GetService("UserInputService")
local PG=game.Players.LocalPlayer:WaitForChild("PlayerGui")
local uisConn=nil 
local dragging=false 
local dragInput,dragStart,startPos

local function C()
    local o=PG:FindFirstChild("CustomFloatingIcon_FyyHub")
    if o then o:Destroy()end 
    local g=Instance.new("ScreenGui")
    g.Name="CustomFloatingIcon_FyyHub"
    g.DisplayOrder=999 
    g.ResetOnSpawn=false 
    local f=Instance.new("Frame")
    f.Size=UDim2.fromOffset(45,45)
    f.Position=UDim2.new(0,50,0.4,0)
    f.AnchorPoint=Vector2.new(.5,.5)
    f.BackgroundColor3=Color3.fromRGB(20,20,20)
    f.BorderSizePixel=0 
    f.Parent=g 
    local s=Instance.new("UIStroke")
    s.Color=Color3.fromRGB(138,43,226)
    s.Thickness=2 
    s.Parent=f 
    Instance.new("UICorner",f).CornerRadius=UDim.new(0,12)
    local i=Instance.new("ImageLabel")
    i.Image="rbxassetid://106899268176689"
    i.BackgroundTransparency=1 
    i.Size=UDim2.new(1,-4,1,-4)
    i.Position=UDim2.fromScale(.5,.5)
    i.AnchorPoint=Vector2.new(.5,.5)
    i.Parent=f 
    Instance.new("UICorner",i).CornerRadius=UDim.new(0,10)
    g.Parent=PG 
    return g,f 
end

local function S(g,f)
    if uisConn then 
        uisConn:Disconnect()
        uisConn=nil 
    end 
    local function u(i)
        local d=i.Position-dragStart 
        f.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+d.X,startPos.Y.Scale,startPos.Y.Offset+d.Y)
    end
    
    f.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then 
            dragging=true 
            dragStart=i.Position 
            startPos=f.Position 
            local m=false 
            local c1,c2 
            c1=i.Changed:Connect(function()
                if i.UserInputState==Enum.UserInputState.End then 
                    dragging=false 
                    c1:Disconnect()
                    if not m and Window and Window.Toggle then 
                        Window:Toggle()
                    end 
                end 
            end)
            c2=i.Changed:Connect(function()
                if dragging and(i.Position-dragStart).Magnitude>5 then 
                    m=true 
                    c2:Disconnect()
                end 
            end)
        end 
    end)
    
    f.InputChanged:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseMovement or i.UserInputType==Enum.UserInputType.Touch then 
            dragInput=i 
        end 
    end)
    
    uisConn=UIS.InputChanged:Connect(function(i)
        if i==dragInput and dragging then 
            u(i)
        end 
    end)
    
    if Window then 
        Window:OnOpen(function()
            g.Enabled=false 
        end)
        Window:OnClose(function()
            g.Enabled=true 
        end)
    end 
end

local function I()
    if not game.Players.LocalPlayer.Character then 
        game.Players.LocalPlayer.CharacterAdded:Wait()
    end 
    local g,f=C()
    if g and f then 
        S(g,f)
    end 
end

game.Players.LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    I()
end)
I()


--//
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RobloxUsername = LocalPlayer.Name

local AuthTab = Window:Tab({
    Title = "Authentication",
    Icon = "key",
})

Window:Divider()
AuthTab:Select()

local AccountTab = nil
local AutowalkTab = nil
local AutosummitTab = nil
local CopyavatarTab = nil
local ToolsTab = nil
local DangerTab = nil
local TeleportTab = nil
local CustomanimationTab = nil
local PlayerTab = nil

local FILE_CONFIG = {
    folder = "FyyAUTH",
    subfolder = "auth",
    filename = "token.dat"
}

local API_CONFIG = {
    base_url = "http://151.240.0.25:3001",
    validate_endpoint = "validate",
    check_endpoint = "check-username"
}

local enteredKey = ""
local menuCreated = false
local isAuthenticating = false

local AccountData = {
    DisplayName = "",
    Username = "",
    Token = "",
    Role = "",
    ExpireDate = "",
    ExpireDays = 0,
    CreatedAt = "",
    WhitelistStatus = "",
    Usernames = {},           
    UsernameCount = 0,        
    UsernameResets = 0,       
    LastUpdated = 0
}

local function getAuthFilePath()
    return FILE_CONFIG.folder .. "/" .. FILE_CONFIG.subfolder .. "/" .. FILE_CONFIG.filename
end

local function saveToken(token)
    local success, err = pcall(function()
        if not isfolder(FILE_CONFIG.folder) then
            makefolder(FILE_CONFIG.folder)
        end
        
        local authFolder = FILE_CONFIG.folder .. "/" .. FILE_CONFIG.subfolder
        if not isfolder(authFolder) then
            makefolder(authFolder)
        end
        
        local data = {
            token = token,
            username = RobloxUsername,
            saved_at = os.time(),
            version = "3.0"
        }
        
        writefile(getAuthFilePath(), HttpService:JSONEncode(data))
    end)
    
    if not success then
        warn("[AUTH] Gagal menyimpan token: " .. tostring(err))
    end
    
    return success
end

local function loadToken()
    local success, result = pcall(function()
        if not isfile(getAuthFilePath()) then
            return nil
        end
        
        local content = readfile(getAuthFilePath())
        local data = HttpService:JSONDecode(content)
        
        if data.username == RobloxUsername then
            return data.token
        else
            return nil
        end
    end)
    
    if success then
        return result
    else
        warn("[AUTH] Failed to load token: " .. tostring(result))
        return nil
    end
end

local function deleteToken()
    pcall(function()
        if isfile(getAuthFilePath()) then
            delfile(getAuthFilePath())
        end
    end)
end

local function safeHttpRequest(url, method, data, headers)
    method = method or "GET"
    
    if not headers then
        headers = {}
    end
    headers["ngrok-skip-browser-warning"] = "true"
    
    local requestData = {
        Url = url,
        Method = method,
        Headers = headers
    }
    
    if data and method == "POST" then
        requestData.Body = data
    end
    
    local ok, res = pcall(function()
        return HttpService:RequestAsync(requestData)
    end)
    
    if ok and res then
        if res.Success and res.StatusCode == 200 then
            return true, res.Body
        elseif res.Success then
            return false, "HTTP Error: " .. (res.StatusCode or "Unknown") .. " - " .. tostring(res.Body or "")
        else
            return false, "Request failed: " .. tostring(res.StatusMessage or "Unknown")
        end
    end

    if method == "GET" then
        local ok2, res2 = pcall(function()
            return HttpService:GetAsync(url, true, headers)
        end)
        if ok2 and res2 then 
            return true, res2 
        end

        local ok3, res3 = pcall(function()
            return game:HttpGet(url)
        end)
        if ok3 and res3 then 
            return true, res3 
        end
        
        return false, "All HTTP methods failed: " .. tostring(res)
    end

    return false, "HTTP request failed: " .. tostring(res)
end

local function updateAccountData(data)
    if data and type(data) == "table" then
        AccountData.DisplayName = LocalPlayer.DisplayName or LocalPlayer.Name
        AccountData.Username = LocalPlayer.Name
        AccountData.Token = getgenv().UserToken or AccountData.Token
        AccountData.Role = data.Role or data.roleId or "Member"
        AccountData.ExpireDate = data.ExpireDate or data.expiresAt or ""
        AccountData.ExpireDays = data.ExpireDays or 0
        AccountData.CreatedAt = data.CreatedAt or os.date("%Y-%m-%d %H:%M:%S")
        AccountData.WhitelistStatus = data.WhitelistStatus or "Active"
        AccountData.Usernames = data.usernames or data.Usernames or {}
        AccountData.UsernameCount = data.UsernameCount or #AccountData.Usernames
        AccountData.UsernameResets = data.UsernameResets or 0
        AccountData.LastUpdated = os.time()
    end
end

local function ValidateKey(key)
    if not key or key == "" then
        return false, "Key tidak boleh kosong!"
    end

    local username = LocalPlayer.Name
    
    local params = {
        key = key,
        username = username,
        robloxId = tostring(LocalPlayer.UserId),
        placeId = tostring(game.PlaceId)
    }
    
    local queryString = ""
    for k, v in pairs(params) do
        if queryString ~= "" then queryString = queryString .. "&" end
        queryString = queryString .. k .. "=" .. HttpService:UrlEncode(tostring(v))
    end
    
    local url = API_CONFIG.base_url .. "/" .. API_CONFIG.validate_endpoint .. "?" .. queryString
    
    local headers = {
        ["Content-Type"] = "application/json",
        ["User-Agent"] = "Roblox/WinInet",
        ["Accept"] = "application/json"
    }

    local ok, responseBody = safeHttpRequest(url, "GET", nil, headers)
    if not ok then
        return false, "Connection error: " .. tostring(responseBody)
    end

    local okDecode, data = pcall(function()
        return HttpService:JSONDecode(responseBody)
    end)
    
    if not okDecode then
        return false, "Invalid server response"
    end
    
    if data.status == "ok" then
        getgenv().UserToken = key
        
        if data.data then
            updateAccountData({
                roleId = data.data.roleId or "Premium",
                expiresAt = data.data.expiresAt or "",
                usernames = data.data.registeredUsernames or {},
                usernameCount = data.data.totalUsernames or 0,
                remainingSlots = data.data.remainingSlots or 0
            })
        end
        
        local successMessages = {
            OK = "Validation successful!",
            FIRST_USER_REGISTERED = "Username pertama berhasil didaftarkan!",
            NEW_USER_ADDED = "Username baru berhasil ditambahkan!"
        }
        
        return true, successMessages[data.code] or "Validation successful!"
    else
        local errorMessages = {
            INVALID_KEY = "Invalid license key",
            BLACKLISTED = "Key diblacklist",
            EXPIRED = "License expired",
            USER_LIMIT_REACHED = "Key sudah mencapai batas 3 username. Reset melalui panel!",
            MISSING_PARAMS = "Missing parameters"
        }
        
        local errorMsg = errorMessages[data.code] or (data.message or "Authentication failed")
        
        if data.code == "USER_LIMIT_REACHED" and data.data then
            errorMsg = errorMsg .. "\n\nUsernames terdaftar:\n"
            for i, uname in ipairs(data.data.registeredUsernames or {}) do
                errorMsg = errorMsg .. "- " .. uname .. "\n"
            end
        end
        
        return false, errorMsg
    end
end

local function GetUserInfo()
    local currentToken = getgenv().UserToken or loadToken()
    
    if not currentToken or currentToken == "" then
        return false, "No token found"
    end

    local params = {
        key = currentToken
    }
    
    local queryString = ""
    for k, v in pairs(params) do
        if queryString ~= "" then queryString = queryString .. "&" end
        queryString = queryString .. k .. "=" .. HttpService:UrlEncode(tostring(v))
    end
    
    local url = API_CONFIG.base_url .. "/" .. API_CONFIG.check_endpoint .. "?" .. queryString
    
    local headers = {
        ["Content-Type"] = "application/json",
        ["User-Agent"] = "Roblox/WinInet"
    }

    local ok, responseBody = safeHttpRequest(url, "GET", nil, headers)
    if not ok then
        return false, "Connection error"
    end

    local okDecode, data = pcall(function()
        return HttpService:JSONDecode(responseBody)
    end)
    
    if not okDecode or data.status ~= "ok" then
        return false, "Failed to get user info"
    end
    
    if data.data then
        updateAccountData({
            roleId = data.data.roleId or "Premium",
            expiresAt = data.data.expiresAt or "",
            usernames = data.data.registeredUsernames or {},
            usernameCount = data.data.totalUsernames or 0,
            usernameResets = data.data.usernameResets or 0,
            daysLeft = data.data.daysLeft or 0,
            blacklisted = data.data.blacklisted or false
        })
        
        return true, AccountData
    end
    
    return false, "No user data found"
end

local function maskName(name)
    if not name or name == "" then
        return "*****"
    end

    local len = #name
    if len <= 5 then
        return string.sub(name, 1, 1) .. string.rep("*", len - 1)
    end

    local first3 = string.sub(name, 1, 2)
    local last2 = string.sub(name, len - 1, len)
    local middle = string.rep("*", len - 5)

    return first3 .. middle .. last2
end

local function maskToken(token)
    if not token or token == "" then
        return "********"
    end

    local len = #token
    if len <= 8 then
        return string.rep("*", len)
    end

    local first5 = string.sub(token, 1, 5)
    local last3 = string.sub(token, len - 2, len)
    local middle = string.rep("*", len - 8)

    return first5 .. middle .. last3
end

local function createAndUnlockAllTabs()
    if not AccountTab then
        AccountTab = Window:Tab({
            Title = "Account",
            Icon = "user",
        })
    end

    if not PlayerTab then
        PlayerTab = Window:Tab({
            Title = "Player Menu",
            Icon = "user-cog",
        })
    end

    if not AutosummitTab then
        AutosummitTab = Window:Tab({
            Title = "Auto Summit",
            Icon = "mountain",
        })
    end

    if not AutowalkTab then
        AutowalkTab = Window:Tab({
            Title = "Auto Walk",
            Icon = "bot",
        })
    end

    if not TeleportTab then
        TeleportTab = Window:Tab({
            Title = "Teleport",
            Icon = "map-pin",
        })
    end

    if not CopyavatarTab then
        CopyavatarTab = Window:Tab({
            Title = "Copy Avatar",
            Icon = "sparkles",
        })
    end

    if not CustomanimationTab then
        CustomanimationTab = Window:Tab({
            Title = "Animation",
            Icon = "person-standing",
        })
    end

    if not ToolsTab then
        ToolsTab = Window:Tab({
            Title = "Tools",
            Icon = "settings",
        })
    end

    if not DangerTab then
        DangerTab = Window:Tab({
            Title = "Danger Zone",
            Icon = "skull",
        })
    end
end

AuthTab:Section({ 
    Title = "Fyy Community | Authentication",
})

AuthTab:Divider()

local InviteCode = "77nEeYeFRp"
local DiscordAPI = "https://discord.com/api/v10/invites/" .. InviteCode .. "?with_counts=true&with_expiration=true"

local Response
local ErrorMessage = nil

xpcall(function()
    Response = game:GetService("HttpService"):JSONDecode(WindUI.Creator.Request({
        Url = DiscordAPI,
        Method = "GET",
        Headers = {
            ["Accept"] = "application/json"
        }
    }).Body)
end, function(err)
    warn("err fetching discord info: " .. tostring(err))
    ErrorMessage = tostring(err)
    Response = nil
end)

if Response and Response.guild then
    local ParagraphConfig = {
        Title = Response.guild.name,
        Desc =
            ' <font color="#52525b">â€¢</font> Member Count: ' .. tostring(Response.approximate_member_count) ..
            '\n <font color="#16a34a">â€¢</font> Online Count: ' .. tostring(Response.approximate_presence_count),
        Image = "https://cdn.discordapp.com/icons/" .. Response.guild.id .. "/" .. Response.guild.icon .. ".png?size=256",
        ImageSize = 42,
        Buttons = {
            {
                Icon = "link",
                Title = "Copy Discord Invite",
                Callback = function()
                    pcall(function()
                        setclipboard("https://discord.gg/" .. InviteCode)
                    end)
                end
            }
        }
    }
    
    if Response.guild.banner then
        ParagraphConfig.Thumbnail = "https://cdn.discordapp.com/banners/" .. Response.guild.id .. "/" .. Response.guild.banner .. ".png?size=256"
        ParagraphConfig.ThumbnailSize = 80
    end
    
    local DiscordInfo = AuthTab:Paragraph(ParagraphConfig)
else
    AuthTab:Paragraph({
        Title = "Error when receiving information about the Discord server",
        Desc = ErrorMessage or "Unknown error occurred",
        Image = "triangle-alert",
        ImageSize = 26,
        Color = "Red",
    })
end

AuthTab:Divider()

AuthTab:Input({
    Title = "Input License Key",
    Type = "Input",
    InputIcon = "key",
    Placeholder = "FYY-000-000-000",
    Callback = function(input) 
        enteredKey = tostring(input or ""):gsub("%s+", ""):gsub("[\n\r\t]", "")
    end
})

AuthTab:Divider()

local function verifyAndLogin()
    if isAuthenticating then
        WindUI:Notify({
            Title = "Tunggu!",
            Content = "Masih dalam proses validasi...",
            Duration = 2,
            Icon = "loader",
        })
        return
    end

    if enteredKey == "" then
        WindUI:Notify({
            Title = "Error!",
            Content = "Masukan key terlebih dahulu!",
            Duration = 3,
            Icon = "triangle-alert",
        })
        return
    end
    
    isAuthenticating = true
    
    WindUI:Notify({
        Title = "Validating...",
        Content = "Pengecekan token dengan username: " .. RobloxUsername,
        Duration = 2,
        Icon = "shield-check",
    })

    local valid, result = ValidateKey(enteredKey)
    
    isAuthenticating = false
    
    if valid then
        saveToken(enteredKey)
        getgenv().AuthComplete = true
        getgenv().AuthTimestamp = os.time()
        
        WindUI:Notify({
            Title = "Key Valid!",
            Content = "Authentication berhasil!",
            Duration = 3,
            Icon = "check-check",
        })
        
        task.wait(0.5)
        
        local userSuccess, userData = GetUserInfo()
        if userSuccess then
            updateAccountData(userData)
        end
        
        task.wait(0.5)
        
        createAndUnlockAllTabs()
        
        WindUI:Notify({
            Title = "Welcome!",
            Content = "Menu utama telah terbuka. Selamat menggunakan!",
            Duration = 3,
            Icon = "sparkles",
        })
        
        AccountTab:Select()
        menuCreated = true
        
    else
        WindUI:Notify({
            Title = "Key Salah!",
            Content = tostring(result),
            Duration = 5,
            Icon = "ban",
        })
    end
end

AuthTab:Button({
    Title = "Verify Key",
    Icon = "shield-check",
    Callback = verifyAndLogin
})

task.spawn(function()
    task.wait(2)
    
    local savedToken = loadToken()
    if savedToken and not menuCreated then
        WindUI:Notify({
            Title = "Auto Login",
            Content = "Mencoba login dengan saved token...",
            Duration = 2,
            Icon = "key-round",
        })
        
        local valid, result = ValidateKey(savedToken)
        if valid then
            getgenv().UserToken = savedToken
            getgenv().AuthComplete = true
            getgenv().AuthTimestamp = os.time()
            
            WindUI:Notify({
                Title = "Auto Login Success!",
                Content = "Welcome back!",
                Duration = 3,
                Icon = "check-check",
            })
            
            task.wait(0.5)
            
            local userSuccess, userData = GetUserInfo()
            if userSuccess then
                updateAccountData(userData)
            end
            
            task.wait(0.5)
            
            createAndUnlockAllTabs()
            AccountTab:Select()
            menuCreated = true

        else
            deleteToken()
            WindUI:Notify({
                Title = "Auto Login Failed",
                Content = "Saved token expired atau invalid. Silakan login manual.",
                Duration = 4,
                Icon = "alert-triangle",
            })
        end
    end
end)

local accountInfoParagraph = nil

local function refreshAccountDisplay()
    if not AccountTab then return "" end
    
    local displayName = maskName(AccountData.DisplayName ~= "" and AccountData.DisplayName or "Loading...")
    local username = maskName(AccountData.Username ~= "" and AccountData.Username or RobloxUsername)
    local token = maskToken(AccountData.Token)
    local role = AccountData.Role ~= "" and AccountData.Role or "Member"
    local expireDays = AccountData.ExpireDays or 0
    local expireDaysFormatted = expireDays > 0 and tostring(expireDays) .. " Days" or "Lifetime"
    local statusText = (expireDays > 0 or AccountData.ExpireDate == "") and "Active" or "Expired"
    
    local usernamesText = ""
    if AccountData.Usernames and #AccountData.Usernames > 0 then
        usernamesText = "\nðŸŽ® Usernames (" .. AccountData.UsernameCount .. "/3):\n"
        for i, uname in ipairs(AccountData.Usernames) do
            if i <= 5 then
                usernamesText = usernamesText .. "  â€¢ " .. uname .. "\n"
            end
        end
        if #AccountData.Usernames > 5 then
            usernamesText = usernamesText .. "  â€¢ ... and " .. (#AccountData.Usernames - 5) .. " more\n"
        end
    else
        usernamesText = "\nðŸŽ® Usernames: Not registered yet\n"
    end
    
    local description = string.format(
        "ðŸ‘¤ Account Information:\n" ..
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" ..
        "ðŸ”¹ Display Name: %s\n" ..
        "ðŸ”¹ Username: %s\n" ..
        "ðŸ”¹ Role: %s\n" ..
        "ðŸ”¹ Token: %s\n" ..
        "ðŸ”¹ Expire: %s\n" ..
        "ðŸ”¹ Status: %s\n" ..
        "â™» Resets: %d" ..
        "%s" ..
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" ..
        "ðŸ“Œ Note: Max 3 usernames per key",
        displayName,
        username,
        role,
        token,
        expireDaysFormatted,
        statusText,
        AccountData.UsernameResets or 0,
        usernamesText
    )
    
    return description
end

local function setupAccountTab()
    if not AccountTab then return end
    
    AccountTab:Section({ 
        Title = "Account Information",
    })

    AccountTab:Divider()

    local success, data = GetUserInfo()
    if success then
        updateAccountData(data)
    end

    local initialDesc = refreshAccountDisplay()

    accountInfoParagraph = AccountTab:Paragraph({
        Title = "Account Information",
        Desc = initialDesc,
    })

    AccountTab:Divider()

    AccountTab:Button({
        Title = "Refresh Account Info",
        Icon = "refresh-ccw",
        Callback = function()
            WindUI:Notify({
                Title = "Refreshing...",
                Content = "Memperbarui data akun...",
                Duration = 2,
                Icon = "loader",
            })
            
            local success, data = GetUserInfo()
            
            if success then
                updateAccountData(data)
                
                local newDesc = refreshAccountDisplay()
                if accountInfoParagraph and accountInfoParagraph.SetDesc then
                    accountInfoParagraph:SetDesc(newDesc)
                end
                
                WindUI:Notify({
                    Title = "Success!",
                    Content = "Data account berhasil diperbarui!",
                    Duration = 4,
                    Icon = "check-check",
                })
            else
                WindUI:Notify({
                    Title = "Error",
                    Content = tostring(data),
                    Duration = 4,
                    Icon = "x-circle",
                })
            end
        end
    })

    AccountTab:Divider()

    AccountTab:Button({
        Title = "Copy Token",
        Icon = "copy",
        Callback = function()
            local token = getgenv().UserToken or AccountData.Token
            if token and token ~= "" then
                setclipboard(token)
                WindUI:Notify({
                    Title = "Copied!",
                    Content = "Token telah disalin ke clipboard",
                    Duration = 3,
                    Icon = "copy-check",
                })
            else
                WindUI:Notify({
                    Title = "Error",
                    Content = "Tidak ada token yang tersedia",
                    Duration = 3,
                    Icon = "x-circle",
                })
            end
        end
    })

    AccountTab:Divider()

    AccountTab:Button({
        Title = "View All Usernames",
        Icon = "users",
        Callback = function()
            if AccountData.Usernames and #AccountData.Usernames > 0 then
                local usernamesList = "ðŸ“‹ Registered Usernames (" .. #AccountData.Usernames .. "/3):\n"
                for i, uname in ipairs(AccountData.Usernames) do
                    usernamesList = usernamesList .. i .. ". " .. uname .. "\n"
                end
                usernamesList = usernamesList .. "\nâ™» Total Resets: " .. (AccountData.UsernameResets or 0)
                
                AccountTab:Paragraph({
                    Title = "Usernames List",
                    Desc = usernamesList,
                })
            else
                WindUI:Notify({
                    Title = "Info",
                    Content = "Belum ada username yang terdaftar",
                    Duration = 3,
                    Icon = "info",
                })
            end
        end
    })
end

task.spawn(function()
    while true do
        task.wait(300)
        if menuCreated and AccountData.Token ~= "" then
            local success, data = GetUserInfo()
            if success then
                updateAccountData(data)
                if accountInfoParagraph and accountInfoParagraph.SetDesc then
                    local newDesc = refreshAccountDisplay()
                    accountInfoParagraph:SetDesc(newDesc)
                end
            end
        end
    end
end)
--//

local function setupAutowalkTab()
    if not AutowalkTab then return end
    
    local RunService = game:GetService("RunService")
    local UserInputService = game:GetService("UserInputService")
    local HttpService = game:GetService("HttpService")
    local Players = game:GetService("Players")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    
    local player = Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

    local selectedJsonURL = nil
    local cachedJsonData = nil
    local autoWalkGUI = nil
    local isWalking = false
    local playbackConnection = nil
    local playbackSpeed = 1.0
    local heightOffset = 0
    local isLoopEnabled = false
    local isAutoRespawnEnabled = false
    local lastPlaybackTime = 0
    local accumulatedTime = 0
    local isReversed = false
    local isFlipped = false
    local FLIP_SMOOTHNESS = 0.20
    local currentFlipRotation = CFrame.new()
    local PATH_THRESHOLD = 8
    local ARRIVAL_THRESHOLD = 2
    
    -- TOOL VARIABLES
    local toolEquipTime = 0
    local toolEquipCooldown = 0.1
    local currentEquippedTool = nil
    
    -- UI BUTTON REFERENCE
    local playStopButton = nil
    
    local trackNames = {
        "MT | Yume (Normal)",
        "MT | Yume (Tali)",
        "MT | Celestra",
        "MT | Kota Bukan Gunung",
        "MT | Luna",
        "MT | Stella",
        "MT | Malaikat",
        "MT | Molti",
        "MT | Sikrit",
        "MT | Sakahayang V2",
        "MT | Kita",
        "MT | Runia V2",
        "MT | Zodiak",
        "MT | Amethyst",
        "MT | Berak",
        "MT | Forever",
        "MT | Freestyle Kzl",
        "MT | Freestyle Kzl Wasd",
        "MT | Aetheria C2",
        "MT | Aetheria C3",
        "MT | Age",
        "MT | Anjir",
        "MT | Axis",
        "MT | Ayriene",
        "MT | Bagendah",
        "MT | Bjirlah",
        "MT | Freestyle",
        "MT | Freestyle Wasd",
        "MT | Funny",
        "MT | Gemi",
        "MT | Jagok",
        "MT | Nagih",
        "MT | Ragon",
        "MT | Velora",
        "MT | Wasabi",
        "MT | Wayang",
        "MT | Wayang Wasd",
        "MT | Yagesya",
        "MT | Yagesya Wasd",
        "MT | Yahayuk",
        "MT | Yahayuk Wasd",
        "MT | Yahayuk Freestyle",
        "MT | Yahayuk CVIP",
        "MT | YNTKTS",
        "MT | Rhizoma",
        "Sadewa City",
        "MT Ngebut",
        "MT Yayakin",
        "MT Yahayuk R6",
        "MT Sendang",
        "MT Vegas",
        "MT Astralyn",
        "MT Astralyn C2",
        "MT Aetheria CVIP",
        "MT Granite",
        "MT Bjirlah (Normal)",
        "MT Bjirlah (Wasd)",
        "MT Gemas",
        "MT Serrat (Jalur 1)",
        "MT Serrat (Jalur 2)",
        "MT Pagi",
        "MT Yntkts (Pro)",
        "MT Yntkts (Dontol)",
        "MT Vexyria",
        "MT Aetheria C2 (Dontol)",
        "MT Aetheria C2 (Pro)",
        "MT Gemi (Normal)",
        "MT Gemi (Wasd)",
        "MT Yahayuk (Jalur 1)",
        "MT Yahayuk (Jalur 2)",
        "MT Yahayuk (Jalur 3)",
        "MT Age Sline",
        "MT Outline (Mode Serius)",
        "MT Yakuja",
        "MT Date"
    }

    local trackURLs = {
        ["MT | Yume (Normal)"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_yume_jalur_normal.json",
        ["MT | Yume (Tali)"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_yume_jalur_tali.json",
        ["MT | Celestra"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_celestra.json",
        ["MT | Kota Bukan Gunung"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/kota_bukan_gunung.json",
        ["MT | Luna"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_luna.json",
        ["MT | Stella"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_stella.json",
        ["MT | Malaikat"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_malaikat.json",
        ["MT | Molti"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_molti.json",
        ["MT | Sikrit"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_sikrit.json",
        ["MT | Sakahayang V2"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_sakahayang_v2.json",
        ["MT | Kita"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_kita.json",
        ["MT | Runia V2"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_runia_v2.json",
        ["MT | Zodiak"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_zodiak.json",
        ["MT | Amethyst"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_amethyst.json",
        ["MT | Berak"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_berak.json",
        ["MT | Forever"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_forever.json",
        ["MT | Freestyle Kzl"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_freestyle_kzl.json",
        ["MT | Freestyle Kzl Wasd"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_freestyle_kzl_wasd.json",
        ["MT | Aetheria C2"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_aetheria_coil_2.json",
        ["MT | Aetheria C3"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_aetheria_coil_3.json",
        ["MT | Age"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_age.json",
        ["MT | Anjir"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_anjir.json",
        ["MT | Axis"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_axis.json",
        ["MT | Ayriene"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_ayriene.json",
        ["MT | Bagendah"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_bagendah.json",
        ["MT | Bjirlah"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_bjirlah.json",
        ["MT | Freestyle"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_freestyle.json",
        ["MT | Freestyle Wasd"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_freestyle_wasd.json",
        ["MT | Funny"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_funny.json",
        ["MT | Gemi"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_gemi_wasd.json",
        ["MT | Jagok"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_jagok.json",
        ["MT | Nagih"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_nagih.json",
        ["MT | Ragon"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_ragon.json",
        ["MT | Velora"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_velora.json",
        ["MT | Wasabi"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_wasabi.json",
        ["MT | Wayang"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_wayang_normal.json",
        ["MT | Wayang Wasd"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_wayang_wasd.json",
        ["MT | Yagesya"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_yagesya.json",
        ["MT | Yagesya Wasd"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_yagesya_wasd.json",
        ["MT | Yahayuk"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_yahayuk.json",
        ["MT | Yahayuk Wasd"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_yahayuk_wasd.json",
        ["MT | Yahayuk Freestyle"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_yahayuk_freestyle.json",
        ["MT | Yahayuk CVIP"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yahayuk_coil_vip.json",
        ["MT | YNTKTS"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_yntkts.json",
        ["MT | Rhizoma"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/mount_rhizoma.json",
        ["Sadewa City"] = "https://raw.githubusercontent.com/SyhrlmyZID/track/refs/heads/main/sadewa_city.json",
        ["MT Ngebut"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_ngebut.json",
        ["MT Yayakin"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yayakin.json",
        ["MT Yahayuk R6"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yahayuk_r6.json",
        ["MT Sendang"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_sendang.json",
        ["MT Vegas"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_vegas.json",
        ["MT Astralyn"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_astralyn.json",
        ["MT Astralyn C2"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_astralyn_coil_2.json",
        ["MT Aetheria CVIP"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_aetheria_coil_vip.json",
        ["MT Granite"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_granite.json",
        ["MT Bjirlah (Normal)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_bjirlah_normal.json",
        ["MT Bjirlah (Wasd)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_bjirlah_wasd.json",
        ["MT Gemas"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_gemas.json",
        ["MT Serrat (Jalur 1)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_serrat_jalur_1.json",
        ["MT Serrat (Jalur 2)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_serrat_jalur_2.json",
        ["MT Pagi"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_pagi.json",
        ["MT Yntkts (Pro)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yntkts_pro.json",
        ["MT Yntkts (Dontol)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yntkts_dontol.json",
        ["MT Vexyria"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_vexyria.json",
        ["MT Aetheria C2 (Dontol)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_aetheria_jalur_dontol_coil_2.json",
        ["MT Aetheria C2 (Pro)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_aetheria_jalur_pro_coil_2.json",
        ["MT Gemi (Normal)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_gemi_jalur_normal.json",
        ["MT Gemi (Wasd)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_gemi_jalur_wasd.json",
        ["MT Yahayuk (Jalur 1)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yahayuk_jalur_1.json",
        ["MT Yahayuk (Jalur 2)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yahayuk_jalur_2.json",
        ["MT Yahayuk (Jalur 3)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yahayuk_jalur_3.json",
        ["MT Age Sline"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_age_sline.json",
        ["MT Outline (Mode Serius)"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_outline.json",
        ["MT Yakuja"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_yakuja.json",
        ["MT Date"] = "https://raw.githubusercontent.com/SyhrlmyZID/data-map/refs/heads/main/mount_date.json"
    }

    local trackLockStatus = {
        ["MT | Yume (Normal)"] = false,
        ["MT | Yume (Tali)"] = false,
        ["MT | Celestra"] = false,
        ["MT | Kota Bukan Gunung"] = false,
        ["MT | Luna"] = false,
        ["MT | Stella"] = false,
        ["MT | Malaikat"] = false,
        ["MT | Molti"] = false,
        ["MT | Sikrit"] = false,
        ["MT | Sakahayang V2"] = false,  
        ["MT | Kita"] = false,
        ["MT | Runia V2"] = false,
        ["MT | Amethyst"] = false,
        ["MT | Berak"] = false,
        ["MT | Forever"] = false,
        ["MT | Freestyle Kzl"] = false,
        ["MT | Freestyle Kzl Wasd"] = false,
        ["MT | Aetheria C2"] = false,
        ["MT | Aetheria C3"] = false,
        ["MT | Age"] = false,
        ["MT | Anjir"] = false,
        ["MT | Axis"] = false,
        ["MT | Ayriene"] = false,
        ["MT | Bagendah"] = false,
        ["MT | Bjirlah"] = false,
        ["MT | Freestyle"] = false,
        ["MT | Freestyle Wasd"] = false,
        ["MT | Funny"] = false,
        ["MT | Jagok"] = false,
        ["MT | Nagih"] = false,
        ["MT | Ragon"] = false,  
        ["MT | Velora"] = false,
        ["MT | Wasabi"] = false,
        ["MT | Wayang"] = false,
        ["MT | Wayang Wasd"] = false,
        ["MT | Yagesya"] = false,
        ["MT | Yagesya Wasd"] = false,
        ["MT | Yahayuk"] = false,
        ["MT | Yahayuk Wasd"] = false,
        ["MT | Yahayuk Freestyle"] = false,
        ["MT | Yahayuk CVIP"] = false,
        ["MT | YNTKTS"] = false,
        ["MT | Rhizoma"] = false,
        ["Sadewa City"] = false,
        ["MT Ngebut"] = false,
        ["MT Yayakin"] = false,  
        ["MT Yahayuk R6"] = false,
        ["MT Sendang"] = false,  
        ["MT Vegas"] = false,
        ["MT Astralyn"] = false,
        ["MT Astralyn C2"] = false,
        ["MT Aetheria CVIP"] = false,  
        ["MT Granite"] = false,
        ["MT Bjirlah (Normal)"] = false,
        ["MT Bjirlah (Wasd)"] = false,
        ["MT Gemas"] = false,
        ["MT Serrat (Jalur 1)"] = false,
        ["MT Serrat (Jalur 2)"] = false,
        ["MT Pagi"] = false,
        ["MT Yntkts (Pro)"] = false,
        ["MT Yntkts (Dontol)"] = false,
        ["MT Vexyria"] = false,
        ["MT Aetheria C2 (Dontol)"] = false,  -- UNLOCKED
        ["MT Aetheria C2 (Pro)"] = false,  -- UNLOCKED
        ["MT Gemi (Normal)"] = false,  -- UNLOCKED
        ["MT Gemi (Wasd)"] = false,  -- UNLOCKED
        ["MT Yahayuk (Jalur 1)"] = false,
        ["MT Yahayuk (Jalur 2)"] = false,
        ["MT Yahayuk (Jalur 3)"] = false,
        ["MT Age Sline"] = false,
        ["MT Outline (Mode Serius)"] = false,
        ["MT Yakuja"] = false,
        ["MT Date"] = false
    }

    local function isTrackLocked(trackName)
        return trackLockStatus[trackName] == true
    end
    
    local function getAvailableTracks()
        local availableTracks = {}
        for _, trackName in ipairs(trackNames) do
            local displayName = trackName
            if isTrackLocked(trackName) then
                displayName = trackName .. " ðŸ”’"
            end
            table.insert(availableTracks, displayName)
        end
        return availableTracks
    end
    
    local function cleanTrackName(displayName)
        return displayName:gsub(" ðŸ”’", "")
    end
    
    local function tableToVec(t)
        return Vector3.new(t.x, t.y, t.z)
    end
    
    local function lerpVector(a, b, t)
        return Vector3.new(a.X + (b.X - a.X) * t, a.Y + (b.Y - a.Y) * t, a.Z + (b.Z - a.Z) * t)
    end
    
    local function lerpAngle(a, b, t)
        local diff = (b - a)
        while diff > math.pi do diff = diff - 2*math.pi end
        while diff < -math.pi do diff = diff + 2*math.pi end
        return a + diff * t
    end
    
    local function loadJsonFromURL(url)
        if not url or url == "" then
            return nil, "URL kosong!"
        end
    
        local success, result = pcall(function()
            return game:HttpGet(url)
        end)
    
        if not success then
            return nil, "Gagal mengunduh JSON dari URL!"
        end
    
        local ok, jsonData = pcall(function()
            return HttpService:JSONDecode(result)
        end)
    
        if not ok then
            return nil, "Format JSON invalid!"
        end
    
        return jsonData, nil
    end

    local function findSurroundingFrames(data, t)
        if #data == 0 then
            return nil, nil, 0
        end
    
        if t <= data[1].time then
            return 1, 1, 0
        end
    
        if t >= data[#data].time then
            return #data, #data, 0
        end
    
        local left, right = 1, #data
        while left < right - 1 do
            local mid = math.floor((left + right) / 2)
            if data[mid].time <= t then
                left = mid
            else
                right = mid
            end
        end
    
        local i0, i1 = left, right
        local span = data[i1].time - data[i0].time
        local alpha = span > 0 and math.clamp((t - data[i0].time) / span, 0, 1) or 0
        return i0, i1, alpha
    end
    
    local function findNearestPointInPath(data, currentPos)
        local nearestIndex = 1
        local nearestDistance = math.huge
        
        for i, frame in ipairs(data) do
            local framePos = tableToVec(frame.position)
            local distance = (currentPos - framePos).Magnitude
            
            if distance < nearestDistance then
                nearestDistance = distance
                nearestIndex = i
            end
        end
        
        return nearestIndex, nearestDistance
    end
    
    local function isPlayerOnPath(currentPos, data, threshold)
        threshold = threshold or PATH_THRESHOLD
        local _, nearestDistance = findNearestPointInPath(data, currentPos)
        return nearestDistance <= threshold, nearestDistance
    end
    
    -- TOOL FUNCTIONS
    local function equipTool(toolName)
        if not toolName or toolName == "" then
            return
        end
        
        pcall(function()
            local backpack = player:FindFirstChild("Backpack")
            if not backpack then return end
            
            local toolToEquip = backpack:FindFirstChild(toolName)
            if not toolToEquip then
                for _, item in ipairs(backpack:GetChildren()) do
                    if item:IsA("Tool") and item.Name:find(toolName) then
                        toolToEquip = item
                        break
                    end
                end
            end
            
            if toolToEquip then
                for _, tool in ipairs(character:GetChildren()) do
                    if tool:IsA("Tool") then
                        tool.Parent = backpack
                    end
                end
                
                toolToEquip.Parent = character
                currentEquippedTool = toolName
            end
        end)
    end
    
    local function unequipAllTools()
        pcall(function()
            local backpack = player:FindFirstChild("Backpack")
            if not backpack then return end
            
            for _, tool in ipairs(character:GetChildren()) do
                if tool:IsA("Tool") then
                    tool.Parent = backpack
                end
            end
            currentEquippedTool = nil
        end)
    end
    
    local function stopPlayback()
        isWalking = false
        accumulatedTime = 0
        lastPlaybackTime = 0
        heightOffset = 0
        isFlipped = false
        currentFlipRotation = CFrame.new()
        currentEquippedTool = nil
    
        if playbackConnection then
            playbackConnection:Disconnect()
            playbackConnection = nil
        end
    
        if character and humanoid then
            humanoid:Move(Vector3.new(0, 0, 0), false)
            if humanoid:GetState() ~= Enum.HumanoidStateType.Running and
                humanoid:GetState() ~= Enum.HumanoidStateType.RunningNoPhysics then
                humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
        end
        
        unequipAllTools()
        
        -- UPDATE UI BUTTON
        if playStopButton then
            playStopButton.Text = "PLAY"
        end
    end
    
    local function walkToPosition(targetPos, callback)
        if not humanoid or not character then
            if callback then callback(false) end
            return
        end
        
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if not hrp then
            if callback then callback(false) end
            return
        end
        
        local distance = (hrp.Position - targetPos).Magnitude
        
        if distance < ARRIVAL_THRESHOLD then
            if callback then callback(true) end
            return
        end
        
        local moveConnection
        local reached = false
        local timeout = false
        
        moveConnection = humanoid.MoveToFinished:Connect(function(isReached)
            reached = true
            if moveConnection then
                moveConnection:Disconnect()
                moveConnection = nil
            end
        end)
        
        humanoid:MoveTo(targetPos)
        
        local startTime = tick()
        local maxWaitTime = 20
        
        while not reached and not timeout do
            task.wait(0.1)
            if (tick() - startTime) >= maxWaitTime then
                timeout = true
            end
        end
        
        if moveConnection then
            moveConnection:Disconnect()
        end
        
        if callback then
            callback(reached and not timeout)
        end
    end
    
    local function killCharacter()
        if character and character:FindFirstChild("Humanoid") then
            character.Humanoid.Health = 0
        end
    end

    local function startPlayback(data, startIndex, skipWalkTo)
        if not data or #data == 0 then
            WindUI:Notify({
                Title = "Error",
                Content = "Data JSON kosong atau tidak valid!",
                Duration = 3,
                Icon = "alert-triangle",
            })
            return
        end
    
        if isWalking then
            stopPlayback()
            return
        end
    
        startIndex = startIndex or 1
        skipWalkTo = skipWalkTo or false
    
        if character and character:FindFirstChild("HumanoidRootPart") and data[startIndex] then
            local startFrame = data[startIndex]
            local startPos = tableToVec(startFrame.position)
            local startYaw = startFrame.rotation or 0
    
            local hrp = character.HumanoidRootPart
            local currentHipHeight = humanoid.HipHeight
            local recordedHipHeight = data[startIndex].hipHeight or 2
            heightOffset = currentHipHeight - recordedHipHeight
    
            if not skipWalkTo then
                local correctedStartY = startPos.Y + heightOffset
                local correctedStartPos = Vector3.new(startPos.X, correctedStartY, startPos.Z)
                hrp.CFrame = CFrame.new(correctedStartPos) * CFrame.Angles(0, startYaw, 0)
                hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                hrp.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
            end
            
            -- Equip tool from first frame
            if data[startIndex].tool then
                equipTool(data[startIndex].tool)
            end
        end
    
        isWalking = true
        local playbackStartTime = tick()
        lastPlaybackTime = playbackStartTime
        accumulatedTime = data[startIndex].time
        local lastJumping = false
    
        if playbackConnection then
            playbackConnection:Disconnect()
            playbackConnection = nil
        end
    
        playbackConnection = RunService.Heartbeat:Connect(function(deltaTime)
            if not isWalking then 
                playbackConnection:Disconnect()
                playbackConnection = nil
                return 
            end
            
            if not character or not character:FindFirstChild("HumanoidRootPart") then 
                stopPlayback()
                return 
            end
            
            if not humanoid or humanoid.Parent ~= character then
                humanoid = character:FindFirstChild("Humanoid")
            end
    
            local currentTime = tick()
            local actualDelta = math.min(currentTime - lastPlaybackTime, 0.1)
            lastPlaybackTime = currentTime
            local totalDuration = data[#data].time
    
            if isReversed then
                accumulatedTime -= (actualDelta * playbackSpeed)
                if accumulatedTime <= data[1].time then
                    if isLoopEnabled then
                        stopPlayback()
                        task.wait(2)
    
                        local hrp = character:FindFirstChild("HumanoidRootPart")
                        if hrp then
                            local endFrame = data[#data]
                            local endPos = tableToVec(endFrame.position)
    
                            walkToPosition(endPos, function(success)
                                if success then
                                    startPlayback(data, #data, true)
                                end
                            end)
                        end
                        return
                    else
                        stopPlayback()
                        return
                    end
                end
            else
                accumulatedTime += (actualDelta * playbackSpeed)
                if accumulatedTime >= totalDuration then
                    stopPlayback()
    
                    if isLoopEnabled and isAutoRespawnEnabled then
                        killCharacter()
    
                        if character and character:FindFirstChild("Humanoid") then
                            character.Humanoid.Died:Wait()
                        end
    
                        local newChar = player.CharacterAdded:Wait()
                        character = newChar
                        task.wait(1)
    
                        startPlayback(data, 1, false)
                        return
                    end
    
                    if isAutoRespawnEnabled and not isLoopEnabled then
                        killCharacter()
    
                        if character and character:FindFirstChild("Humanoid") then
                            character.Humanoid.Died:Wait()
                        end
    
                        return
                    end
    
                    if isLoopEnabled and not isAutoRespawnEnabled then
                        task.wait(1)
    
                        local hrp = character:FindFirstChild("HumanoidRootPart")
                        if hrp then
                            local startFrame = data[1]
                            local startPos = tableToVec(startFrame.position)
    
                            walkToPosition(startPos, function(success)
                                if success then
                                    startPlayback(data, 1, true)
                                end
                            end)
                        end
                        return
                    end
    
                    return
                end
            end
    
            local i0, i1, alpha = findSurroundingFrames(data, accumulatedTime)
            local f0, f1 = data[i0], data[i1]
            if not f0 or not f1 then 
                stopPlayback()
                return 
            end
    
            local pos0, pos1 = tableToVec(f0.position), tableToVec(f1.position)
            local vel0, vel1 = tableToVec(f0.velocity or {x=0,y=0,z=0}), tableToVec(f1.velocity or {x=0,y=0,z=0})
            local move0, move1 = tableToVec(f0.moveDirection or {x=0,y=0,z=0}), tableToVec(f1.moveDirection or {x=0,y=0,z=0})
            local yaw0, yaw1 = f0.rotation or 0, f1.rotation or 0
    
            local interpPos = lerpVector(pos0, pos1, alpha)
            local interpVel = lerpVector(vel0, vel1, alpha)
            local interpMove = lerpVector(move0, move1, alpha)
            local interpYaw = lerpAngle(yaw0, yaw1, alpha)
            local hrp = character.HumanoidRootPart

            if isReversed then
                interpVel = -interpVel
                interpMove = -interpMove
            end
            
            local correctedY = interpPos.Y + heightOffset
            local targetCFrame = CFrame.new(interpPos.X, correctedY, interpPos.Z) * CFrame.Angles(0, interpYaw, 0)
            local targetFlipRotation = isFlipped and CFrame.Angles(0, math.pi, 0) or CFrame.new()
            currentFlipRotation = currentFlipRotation:Lerp(targetFlipRotation, FLIP_SMOOTHNESS)
            local lerpFactor = math.clamp(1 - math.exp(-12 * actualDelta), 0, 1)
            hrp.CFrame = hrp.CFrame:Lerp(targetCFrame * currentFlipRotation, lerpFactor)
    
            pcall(function()
                hrp.AssemblyLinearVelocity = interpVel
            end)
    
            if humanoid then
                humanoid:Move(interpMove, false)
            end
    
            -- TOOL HANDLING
            if currentTime - toolEquipTime >= toolEquipCooldown then
                local frameTool = f0.tool
                if frameTool and frameTool ~= currentEquippedTool then
                    equipTool(frameTool)
                    toolEquipTime = currentTime
                elseif not frameTool and currentEquippedTool then
                    unequipAllTools()
                    toolEquipTime = currentTime
                end
            end
    
            local jumpingNow = f0.jumping or false
            if f1.jumping then jumpingNow = true end
            if jumpingNow and not lastJumping then
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
            lastJumping = jumpingNow
        end)
    end
    
    local isLoadingTrack = false
    
    local function loadTrackData()
        if isLoadingTrack then return false end
        
        if not selectedJsonURL then
            WindUI:Notify({
                Title = "Auto Walk",
                Content = "Silakan pilih track terlebih dahulu!",
                Duration = 3,
                Icon = "triangle-alert",
            })
            return false
        end
        
        if not cachedJsonData then
            isLoadingTrack = true
            WindUI:Notify({
                Title = "Loading",
                Content = "Mendownload checkpoint...",
                Duration = 1.5,
                Icon = "download",
            })
            
            local jsonData, errorMsg = loadJsonFromURL(selectedJsonURL)
            
            if not jsonData then
                isLoadingTrack = false
                WindUI:Notify({
                    Title = "Error",
                    Content = errorMsg or "Gagal memuat track!",
                    Duration = 5,
                    Icon = "alert-triangle",
                })
                return false
            end
            
            cachedJsonData = jsonData
            isLoadingTrack = false
            WindUI:Notify({
                Title = "Success",
                Content = "Checkpoint siap!",
                Duration = 1.5,
                Icon = "check",
            })
        end
        
        return true
    end
    
    local function toggleAutoWalk()
        if not loadTrackData() then return end
        
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if not hrp then
            WindUI:Notify({
                Title = "Error",
                Content = "Character tidak ditemukan!",
                Duration = 2,
                Icon = "alert-triangle",
            })
            return
        end

        local currentPos = hrp.Position
        local nearestIndex, nearestDistance = findNearestPointInPath(cachedJsonData, currentPos)
        local MAX_PLAY_DISTANCE = 50
        
        if nearestDistance > MAX_PLAY_DISTANCE then
            WindUI:Notify({
                Title = "Auto Walk",
                Content = string.format("Terlalu jauh dari jalur (%.1f studs)!", nearestDistance),
                Duration = 3,
                Icon = "bot",
            })
            return
        end

        if isWalking then
            stopPlayback()
            return
        end

        if autoWalkGUI and autoWalkGUI.Enabled then
            local container = autoWalkGUI:FindFirstChild("MainFrame")
            if container then
                container = container:FindFirstChild("container")
                if container then
                    for _, child in ipairs(container:GetChildren()) do
                        if child:IsA("TextButton") and (child.Text == "PLAY" or child.Text == "STOP") then
                            child.Text = "STOP"
                            playStopButton = child
                            break
                        end
                    end
                end
            end
        end

        local onPath = isPlayerOnPath(currentPos, cachedJsonData, PATH_THRESHOLD)
        if onPath then
            startPlayback(cachedJsonData, nearestIndex, true)
        else
            local targetFrame = cachedJsonData[nearestIndex]
            local targetPos = tableToVec(targetFrame.position)
            walkToPosition(targetPos, function(success)
                if success then
                    startPlayback(cachedJsonData, nearestIndex, false)
                else
                    if playStopButton then
                        playStopButton.Text = "PLAY"
                    end
                end
            end)
        end
    end
    
    local function createAutoWalkGUI()
        if autoWalkGUI then
            autoWalkGUI.Enabled = true
            return
        end
    
        local playerGui = player:WaitForChild("PlayerGui")
    
        autoWalkGUI = Instance.new("ScreenGui")
        autoWalkGUI.Name = "AutoWalkControlGUI"
        autoWalkGUI.ResetOnSpawn = false
        autoWalkGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
        local success = pcall(function()
            autoWalkGUI.Parent = game:GetService("CoreGui")
        end)
        if not success then
            autoWalkGUI.Parent = playerGui
        end
    
        local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
        
        local mainFrame = Instance.new("Frame")
        mainFrame.Name = "MainFrame"
        if isMobile then
            mainFrame.Size = UDim2.new(0, 220, 0, 60)
            mainFrame.Position = UDim2.new(0.5, -110, 1, -120)
        else
            mainFrame.Size = UDim2.new(0, 280, 0, 70)
            mainFrame.Position = UDim2.new(0.5, -140, 1, -140)
        end
        mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        mainFrame.BorderSizePixel = 0
        mainFrame.Active = true
        mainFrame.Selectable = true
        mainFrame.Parent = autoWalkGUI
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 10)
        corner.Parent = mainFrame
        
        local stroke = Instance.new("UIStroke")
        stroke.Color = Color3.fromRGB(138, 43, 226)
        stroke.Thickness = 2
        stroke.Parent = mainFrame
        
        local dragBar = Instance.new("Frame")
        dragBar.Name = "DragBar"
        dragBar.Size = UDim2.new(0.7, 0, 0, isMobile and 6 or 8)
        dragBar.Position = UDim2.new(0.15, 0, 1, isMobile and 4 or 6)
        dragBar.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
        dragBar.BorderSizePixel = 0
        dragBar.Active = true
        dragBar.Selectable = true
        dragBar.Parent = mainFrame
        
        local dragCorner = Instance.new("UICorner")
        dragCorner.CornerRadius = UDim.new(1, 0)
        dragCorner.Parent = dragBar
        
        local dragStroke = Instance.new("UIStroke")
        dragStroke.Color = Color3.fromRGB(138, 43, 226)
        dragStroke.Thickness = 1
        dragStroke.Parent = dragBar
        
        dragBar.MouseEnter:Connect(function()
            dragBar.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
        end)
        dragBar.MouseLeave:Connect(function()
            dragBar.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
        end)
    
        local dragging = false
        local dragInput, dragStart, startPos
    
        local function update(input)
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    
        local function startDrag(input)
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
    
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    
        local function connectDragArea(guiObject)
            guiObject.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or 
                   input.UserInputType == Enum.UserInputType.Touch then
                    startDrag(input)
                end
            end)
    
            guiObject.InputChanged:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseMovement or
                   input.UserInputType == Enum.UserInputType.Touch then
                    dragInput = input
                end
            end)
        end
    
        connectDragArea(mainFrame)
        connectDragArea(dragBar)
    
        UserInputService.InputChanged:Connect(function(input)
            if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or 
                             input.UserInputType == Enum.UserInputType.Touch) then
                update(input)
            end
        end)
        
        local container = Instance.new("Frame")
        container.Name = "container"
        container.Size = UDim2.new(1, -16, 1, -16)
        container.Position = UDim2.new(0, 8, 0, 8)
        container.BackgroundTransparency = 1
        container.Parent = mainFrame
    
        local layout = Instance.new("UIListLayout")
        layout.FillDirection = Enum.FillDirection.Horizontal
        layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        layout.VerticalAlignment = Enum.VerticalAlignment.Center
        layout.Padding = UDim.new(0, isMobile and 6 or 10)
        layout.Parent = container
    
        local function createButton(icon, callback)
            local btn = Instance.new("TextButton")
            if isMobile then
                btn.Size = UDim2.new(0, 60, 0, 32)
            else
                btn.Size = UDim2.new(0, 80, 0, 40)
            end
            btn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
            btn.BorderSizePixel = 0
            btn.Text = icon
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.TextSize = isMobile and 10 or 12
            btn.Font = Enum.Font.GothamBold
            btn.AutoButtonColor = false
            btn.Parent = container
    
            local c = Instance.new("UICorner")
            c.CornerRadius = UDim.new(0, isMobile and 6 or 8)
            c.Parent = btn
    
            local s = Instance.new("UIStroke")
            s.Color = Color3.fromRGB(138, 43, 226)
            s.Thickness = 1.5
            s.Parent = btn
    
            btn.MouseEnter:Connect(function()
                btn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
            end)
            btn.MouseLeave:Connect(function()
                local currentColor = btn.BackgroundColor3
                if currentColor ~= Color3.fromRGB(138, 43, 226) and currentColor ~= Color3.fromRGB(30, 180, 80) then
                    btn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
                end
            end)
    
            btn.Activated:Connect(function()
                if callback then 
                    callback(btn)
                end
            end)
            
            return btn
        end
    
        playStopButton = createButton("PLAY", function(btn)
            toggleAutoWalk()
        end)

        local rollbackBtn = createButton("REV", function(btn)
            isReversed = not isReversed
            if isReversed then
                btn.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
                WindUI:Notify({
                    Title = "Auto Walk",
                    Content = "Reverse Mode: ON",
                    Duration = 2,
                    Icon = "rewind",
                })
            else
                btn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
                WindUI:Notify({
                    Title = "Auto Walk",
                    Content = "Reverse Mode: OFF",
                    Duration = 2,
                    Icon = "rewind",
                })
            end
        end)

        local rotateBtn = createButton("FLIP", function(btn)
            isFlipped = not isFlipped
            if isFlipped then
                btn.BackgroundColor3 = Color3.fromRGB(30, 180, 80)
                WindUI:Notify({
                    Title = "Auto Walk",
                    Content = "Flip Mode: ON (Karakter berputar 180Â°)",
                    Duration = 3,
                    Icon = "rotate-ccw",
                })
            else
                btn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
                WindUI:Notify({
                    Title = "Auto Walk",
                    Content = "Flip Mode: OFF",
                    Duration = 2,
                    Icon = "rotate-ccw",
                })
            end
        end)
    end
    
    local function hideAutoWalkGUI()
        if autoWalkGUI and autoWalkGUI.Parent then
            autoWalkGUI.Enabled = false
        end
    end
    
    player.CharacterAdded:Connect(function(newChar)
        character = newChar
        humanoid = character:WaitForChild("Humanoid")
        humanoidRootPart = character:WaitForChild("HumanoidRootPart")
        
        if isWalking then
            stopPlayback()
        end
    end)

    AutowalkTab:Section({ 
        Title = "Auto Walk | Setting",
        TextTransparency = 0.05,
        TextXAlignment = "Left",
        TextSize = 17,
    })

    AutowalkTab:Toggle({
        Title = "Enable Loop",
        Desc = "Berfungsi menjalankan auto walk secara berulang ulang.",
        Icon = "check",
        Type = "Checkbox",
        Value = false,
        Callback = function(state)
            isLoopEnabled = state
        end
    })

    AutowalkTab:Toggle({
        Title = "Auto Respawn",
        Desc = "Respawn otomatis saat mencapai checkpoint terakhir.",
        Icon = "check",
        Type = "Checkbox",
        Value = false,
        Callback = function(state)
            isAutoRespawnEnabled = state
        end
    })

    AutowalkTab:Slider({
        Title = "Speed Auto Walk",
        Desc = "Berfungsi mengatur kecepatan auto walk.",
        Step = 0.1,
        Value = {
            Min = 0.5,
            Max = 5,
            Default = 1.0,
        },
        Callback = function(value)
            playbackSpeed = value
        end
    })

    AutowalkTab:Divider()

    AutowalkTab:Section({ 
        Title = "Auto Walk | Menu",
        TextTransparency = 0.05,
        TextXAlignment = "Left",
        TextSize = 17,
    })

    AutowalkTab:Dropdown({
        Title = "SELECT TRACK",
        Values = getAvailableTracks(),
        Multi = false,
        AllowNone = true,
        SearchBarEnabled = true,
        Callback = function(selectedName)
            local cleanName = cleanTrackName(selectedName)

            if isTrackLocked(cleanName) then
                WindUI:Notify({
                    Title = "Map Locked ðŸ”’",
                    Content = "Track masih terkunci!",
                    Duration = 4,
                    Icon = "lock",
                })
                selectedJsonURL = nil
                cachedJsonData = nil
                return
            end

            selectedJsonURL = trackURLs[cleanName]
            cachedJsonData = nil

            WindUI:Notify({
                Title = "Track",
                Content = "Track '" .. cleanName .. "' dipilih!",
                Duration = 2,
                Icon = "check",
            })
        end
    })

    AutowalkTab:Toggle({
        Title = "Show/Hide Auto Walk",
        Desc = "Menampilkan / menyembunyikan menu Auto Walk.",
        Icon = "eye",
        Value = false,
        Callback = function(state)
            if state == true then
                createAutoWalkGUI()
            else
                hideAutoWalkGUI()
            end
        end
    })
end


task.spawn(function()
    while true do
        task.wait(1)
        if menuCreated then
            setupAccountTab()
            setupAutowalkTab()
            setupTeleportTab()
            setupToolsTab()
            setupCopyavatarTab()
            setupCustomanimationTab()
            setupPlayerTab()
            setupDangerTab()
            break
        end
    end
end)
